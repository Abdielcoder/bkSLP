<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="../assets/icons/favicon.ico" />
    <title>Tu Taxi - Concesionarios</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="../css/docs/tadiDefaults.css" />
    <link rel="stylesheet" href="../css/docs/concesionarios.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Icons+Sharp"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.11.3/b-2.1.1/b-html5-2.1.1/b-print-2.1.1/date-1.1.1/sb-1.3.0/datatables.min.css"
    />
    <!-- <link rel="stylesheet" href="../css/coreui.css"> -->
  </head>

  <body>
    <div id="root" class="preload">
      <!-- Aside -->
      <aside>
        <div id="aside-container">
          <div class="logo">
            <a class="home-link" href="./main.html">Tu Taxi | Backoffice</a>
          </div>
          <hr />
          <ul class="nav">
            <li class="nav-item" id="mapa-menu-li" style="display: none">
              <a class="nav-link" href="./maps.html">
                <span class="link-icons material-icons-sharp">map</span>
                MAPA
              </a>
            </li>
            <li
              class="nav-item"
              id="concesionario-menu-li"
              style="display: none"
            >
              <a
                class="nav-link hasSubmenu selectedPage"
                href="#"
                id="concesionario"
              >
                <span class="link-icons material-icons-sharp">person</span>
                CONCESIONARIOS
              </a>
              <div id="concesionario-submenu" data-displayed="hidden">
                <ul class="nav-link-submenu">
                  <li
                    class="nav-item-submenu"
                    id="vehiculos-submenu-li"
                    style="display: none"
                  >
                    <a class="nav-link" href="./vehicles.html">
                      <span class="link-icons material-icons-sharp"
                        >directions_car</span
                      >
                      VEHICULOS
                    </a>
                  </li>
                  <li
                    class="nav-item"
                    id="conductores-submenu-li"
                    style="display: none"
                  >
                    <a class="nav-link" href="./users.html">
                      <span class="link-icons material-icons-sharp"
                        >person</span
                      >
                      CONDUCTORES
                    </a>
                  </li>
                </ul>
              </div>
            </li>
            <li class="nav-item" id="vehiculos-menu-li" style="display: none">
              <a class="nav-link" href="./vehicles.html">
                <span class="link-icons material-icons-sharp"
                  >directions_car</span
                >
                VEHICULO
              </a>
            </li>
            <li class="nav-item" id="conductores-menu-li" style="display: none">
              <a class="nav-link" href="./users.html">
                <span class="link-icons material-icons-sharp">person</span>
                CONDUCTORES
              </a>
            </li>
            <li class="nav-item" id="chats-menu-li">
              <a class="nav-link" href="#">
                <span class="link-icons material-icons-sharp">chat</span>
                CHATS
              </a>
            </li>
            <li class="nav-item" id="historico-menu-li">
              <a class="nav-link" href="#">
                <span class="link-icons material-icons-sharp">token</span>
                HISTORICO DE VIAJES
              </a>
            </li>
            <li
              class="nav-item menu-button menu-closed"
              id="admin-menu-li"
              style="display: none"
            >
              <a class="nav-link" href="#" id="administracion">
                <span class="link-icons material-icons-sharp"
                  >manage_accounts</span
                >
                ADMINISTRACIÓN
              </a>
              <div id="administracion-submenu" data-displayed="hidden">
                <ul>
                  <li class="nav-item menu-linked hidden">
                    <a class="nav-sublink" href="../admin/mensajes/index.html">
                      <span class="link-icons material-icons-sharp">chat</span>
                      MENSAJES
                    </a>
                  </li>
                  <li class="nav-item menu-linked hidden">
                    <a
                      class="nav-sublink"
                      href="../admin/administradores/index.html"
                    >
                      <span class="link-icons material-icons-sharp"
                        >person</span
                      >
                      ADMINISTRADORES
                    </a>
                  </li>
                  <li
                    class="nav-item menu-linked hidden"
                    id="roles-menu-li"
                    style="display: none"
                  >
                    <a class="nav-sublink" href="../admin/roles/index.html">
                      <span class="link-icons material-icons-sharp"
                        >groups</span
                      >
                      ROLES
                    </a>
                  </li>
                  <li class="nav-item menu-linked hidden">
                    <a class="nav-sublink" href="#">
                      <span class="link-icons material-icons-sharp"
                        >person_pin</span
                      >
                      CLIENTES
                    </a>
                  </li>
                  <li class="nav-item menu-linked hidden">
                    <a class="nav-sublink" href="../admin/rates.html">
                      <span class="link-icons material-icons-sharp">paid</span>
                      TARIFAS
                    </a>
                  </li>
                  <li class="nav-item menu-linked hidden">
                    <a class="nav-sublink" href="../admin/base_rates.html">
                      <span class="link-icons material-icons-sharp"
                        >attach_money</span
                      >
                      TARIFAS BASE
                    </a>
                  </li>
                </ul>
              </div>
            </li>
            <li class="nav-item" id="clientes-menu-li">
              <a class="nav-link" href="#">
                <span class="link-icons material-icons-sharp">
                  airline_seat_recline_extra</span
                >
                CLIENTES
              </a>
            </li>
          </ul>
        </div>
      </aside>

      <!-- Header  -->
      <header>
        <nav>
          <h1 class="app-title">Tu taxi - Portal Administrativo</h1>
          <button class="close-app" id="signout-button">
            <span class="material-icons-sharp">logout</span>
            Cerrar Sesión
          </button>
        </nav>
        <div class="header-bg-image"></div>
      </header>

      <!-- Main -->
      <main style="position: relative">
        <div class="container">
          <div class="tadi-card col-12">
            <div class="card-header">
              <h1>Registro concesionarios</h1>
              <br />
              <p>
                Listado de concesionarios y recopilación de la información
                general dentro del empadronamiento actual.
              </p>
            </div>
            <div class="card-body">
              <button
                id="userAdd"
                type="button"
                class="dateElement"
                style="margin-left: auto; padding: 4px 16px"
              >
                <span>NUEVO</span>
                <svg
                  width="24px"
                  height="24px"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                  <g
                    id="SVGRepo_tracerCarrier"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  ></g>
                  <g id="SVGRepo_iconCarrier">
                    <path
                      d="M7 12L12 12M12 12L17 12M12 12V7M12 12L12 17"
                      stroke="#ffffff"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    ></path>
                  </g>
                </svg>
              </button>
              <div class="table-container">
                <table id="concesionariosTable">
                  <thead>
                    <tr>
                      <th>Nombre completo</th>
                      <th>Genero</th>
                      <th>Email</th>
                      <th>Teléfono</th>
                      <th>Curp</th>
                      <th>Num. Económico</th>
                      <th>Gafete SCT</th>
                      <th>Fecha de registro</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal -->
        <div id="usuariosAltaModal" class="modalForm" data-reference="">
          <div class="modalContent">
            <div class="containerHead">
              <h2 style="font-size: 20px; text-align: start">
                Información general del concesionario
              </h2>
            </div>
            <div class="contentTabs">
              <ul class="tab-list">
                <li>
                  <button
                    type="button"
                    class="tab-button"
                    aria-selected="true"
                    data-tab="data"
                  >
                    <span>Datos</span>
                  </button>
                </li>
                <li>
                  <button
                    type="button"
                    class="tab-button"
                    aria-selected="false"
                    data-tab="accounts"
                  >
                    <span>Vehículos</span>
                  </button>
                </li>
                <li>
                  <button
                    type="button"
                    class="tab-button"
                    aria-selected="false"
                    data-tab="files"
                  >
                    <span>Archivos</span>
                  </button>
                </li>
                <li>
                  <button
                    type="button"
                    class="tab-button"
                    aria-selected="false"
                    data-tab="drivers"
                  >
                    <span>Conductores</span>
                  </button>
                </li>
              </ul>
            </div>
            <div
              class="formContainer"
              data-tabcontainer="data"
              data-visibility="true"
              style="max-width: 960px"
            >
              <div class="containerBody">
                <form id="userAlta">
                  <h2
                    style="
                      font-size: 20px;
                      display: block;
                      padding: 1rem 0;
                      line-height: 1;
                      color: #d3660e;
                    "
                  >
                    Datos Personales
                  </h2>

                  <div class="form-columns" style="flex-wrap: nowrap">
                    <div class="formGroup inputForm">
                      <label for="nombre">Nombre(s)</label>
                      <input
                        type="text"
                        placeholder="Nombre(s)"
                        name="nombre"
                        id="nombre"
                        maxlength="40"
                        style="text-transform: uppercase"
                        required
                        class="only-letters"
                      />
                    </div>
                    <div class="formGroup inputForm">
                      <label for="apellidoPaterno">Apellido Paterno</label>
                      <input
                        type="text"
                        placeholder="Apellido Paterno"
                        name="apellidoPaterno"
                        id="apellidoPaterno"
                        maxlength="20"
                        class="only-letters"
                        style="text-transform: uppercase"
                        required
                      />
                    </div>
                    <div class="formGroup inputForm">
                      <label for="apellidoMaterno">Apellido Materno</label>
                      <input
                        type="text"
                        placeholder="Apellido Materno"
                        name="apellidoMaterno"
                        id="apellidoMaterno"
                        maxlength="20"
                        class="only-letters"
                        style="text-transform: uppercase"
                        required
                      />
                    </div>
                    <div class="formGroup inputForm">
                      <label for="correoElectronico">Correo electrónico</label>
                      <input
                        type="email"
                        placeholder="Correo electrónico"
                        name="correoElectronico"
                        id="correoElectronico"
                        required
                      />
                    </div>
                  </div>

                  <div class="form-columns" style="flex-wrap: nowrap">
                    <div class="formGroup selectForm" style="max-width: 120px">
                      <label for="sexo">Genero</label>
                      <select name="sexo" id="sexo">
                        <option value="F" selected>Femenino</option>
                        <option value="M">Masculino</option>
                        <option value="Otro">Otro</option>
                      </select>
                    </div>
                    <div class="formGroup inputForm">
                      <label for="curp">Curp</label>
                      <input
                        type="text"
                        placeholder="Curp"
                        name="curp"
                        id="curp"
                        required
                        class="only-characters"
                        maxlength="18"
                        data-length="18"
                        style="text-transform: uppercase"
                      />
                    </div>
                    <div class="formGroup inputForm">
                      <label for="rfc">RFC</label>
                      <input
                        type="text"
                        placeholder="RFC"
                        name="rfc"
                        id="rfc"
                        required
                        style="text-transform: uppercase"
                        maxlength="16"
                        data-length="16"
                      />
                    </div>
                  </div>
                  <div class="form-columns" style="flex-wrap: nowrap">
                    <div class="formGroup selectForm" style="max-width: 120px">
                      <label for="tipoSangre">Tipo de sangre</label>
                      <select name="tipoSangre" id="tipoSangre" required>
                        <option value="A-">A-</option>
                        <option value="A+">A+</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                      </select>
                    </div>
                    <div class="formGroup inputForm">
                      <label for="telefono">Teléfono</label>
                      <input
                        type="tel"
                        placeholder="Teléfono"
                        name="telefono"
                        class="only-numbers"
                        id="telefono"
                        required
                        data-length="10"
                        maxlength="10"
                      />
                    </div>
                    <div class="formGroup inputForm">
                      <label for="telefonoEmergencia"
                        >Teléfono de Emergencia</label
                      >
                      <input
                        type="tel"
                        placeholder="Teléfono de emergencia"
                        name="telefonoEmergencia"
                        id="telefonoEmergencia"
                        class="only-numbers"
                        required
                        data-length="10"
                        maxlength="10"
                      />
                    </div>
                    <div class="formGroup inputForm">
                      <label for="numeroEconomico">Numero Económico</label>
                      <input
                        type="text"
                        placeholder="Número económico"
                        name="numeroEconomico"
                        id="numeroEconomico"
                        class="only-numbers"
                        maxlength="4"
                        data-length="4"
                        required
                      />
                    </div>
                    <div class="formGroup inputForm">
                      <label for="numGafeteSCT">Gafete SCT</label>
                      <input
                        type="text"
                        placeholder="Gafete SCT"
                        name="numGafeteSCT"
                        maxlength="5"
                        data-length="5"
                        class="only-characters"
                        style="text-transform: uppercase"
                        id="numGafeteSCT"
                        required
                      />
                    </div>
                  </div>
                  <div
                    class="form-columns"
                    data-columns="3"
                    style="flex-wrap: nowrap"
                  >
                    <div class="formGroup inputForm">
                      <label for="calle">Calle</label>
                      <input
                        type="text"
                        placeholder="Calle"
                        name="calle"
                        id="calle"
                        maxlength="80"
                        class="only-characters-spaces"
                        required
                      />
                    </div>
                    <div
                      class="formGroup inputForm"
                      style="max-width: 120px; width: 100%"
                    >
                      <label for="numeroCasa">Número</label>
                      <input
                        type="text"
                        placeholder="Número"
                        name="numeroCasa"
                        id="numeroCasa"
                        class="only-characters-spaces"
                        maxlength="10"
                        required
                      />
                    </div>
                    <div class="formGroup inputForm">
                      <label for="colonia">Colonia o Fraccionamiento</label>
                      <input
                        type="text"
                        placeholder="Colonia"
                        name="colonia"
                        class="only-letters"
                        maxlength="80"
                        id="colonia"
                        class="only-letters"
                        required
                      />
                    </div>
                    <div
                      class="formGroup inputForm"
                      style="max-width: 120px; width: 100%"
                    >
                      <label for="cp">Código Postal</label>
                      <input
                        type="text"
                        placeholder="Código postal"
                        name="cp"
                        maxlength="5"
                        data-length="5"
                        class="only-numbers"
                        id="cp"
                        required
                      />
                    </div>
                    <div
                      class="formGroup selectForm"
                      style="max-width: 140px; width: 100%"
                    >
                      <label for="municipio">Municipio</label>
                      <select name="municipio" id="municipio" required>
                        <option value="sanluis">SAN LUIS POTOSI</option>
                        <option value="soledaddegraciano">
                          SOLEDAD DE GRACIANO SÁNCHEZ
                        </option>
                      </select>
                    </div>
                  </div>

                  <div class="checkbox-group">
                    <div class="group-left">
                      <div class="formParraf">
                        <p style="font-size: 14px">
                          Desea o puede realizar viajes para personas con:
                        </p>
                      </div>
                      <div class="checkboxGroup">
                        <div class="formGroup checkboxForm">
                          <input
                            type="checkbox"
                            name="especiales"
                            id="especiales"
                          />
                          <label for="especiales"
                            >Persona con discapacidad</label
                          >
                        </div>
                        <div class="formGroup checkboxForm">
                          <input
                            type="checkbox"
                            name="mascotas"
                            id="mascotas"
                          />
                          <label for="mascotas">Mascotas</label>
                        </div>
                        <div class="formGroup checkboxForm">
                          <input
                            type="checkbox"
                            name="equipaje"
                            id="equipaje"
                          />
                          <label for="equipaje">Equipaje</label>
                        </div>
                      </div>
                    </div>
                    <div class="group-right">
                      <div class="formParraf">
                        <p style="font-size: 14px">
                          Padece de alguna de las siguentes enfermedades
                          crónicas:
                        </p>
                      </div>
                      <div class="checkboxGroup">
                        <div class="formGroup checkboxForm">
                          <input
                            type="checkbox"
                            name="hipertension"
                            id="hipertension"
                          />
                          <label for="hipertension">Hipertensión</label>
                        </div>
                        <div class="formGroup checkboxForm">
                          <input
                            type="checkbox"
                            name="diabetes"
                            id="diabetes"
                          />
                          <label for="diabetes">Diabetes</label>
                        </div>
                        <div class="formGroup checkboxForm">
                          <input type="checkbox" name="epoc" id="epoc" />
                          <label for="epoc" style="white-space: nowrap"
                            >Epoc (Enfermedad Pulmonar Obstructiva
                            Crónica)</label
                          >
                        </div>
                        <div class="formGroup checkboxForm">
                          <input
                            type="checkbox"
                            name="cardiaca"
                            id="cardiaca"
                          />
                          <label for="cardiaca">Insuficiencia cardiaca</label>
                        </div>

                        <div class="formGroup checkboxForm">
                          <input
                            type="checkbox"
                            name="otrasEnfermedades"
                            id="otrasEnfermedades"
                          />
                          <label for="otrasEnfermedades">Otros:</label>
                          <br />
                          <textarea
                            name="otrasEnfermedadesTexto"
                            id="otrasEnfermedadesTexto"
                            cols="30"
                            rows="10"
                            style="
                              width: 250px;
                              font-size: 12px;
                              padding: 8px;
                              height: 60px;
                              border: 1px solid #333;
                              border-radius: 4px;
                              resize: none;
                            "
                          ></textarea>
                        </div>
                      </div>
                    </div>
                    <div class="group-right">
                      <div class="formParraf">
                        <p style="font-size: 14px">
                          Capacitaciones tomadas por el concesionario:
                        </p>
                      </div>
                      <div class="checkboxGroup">
                        <div class="formGroup checkboxForm">
                          <input type="checkbox" name="rcp" id="rcp" />
                          <label for="rcp">RCP</label>
                        </div>
                        <div class="formGroup checkboxForm">
                          <input
                            type="checkbox"
                            name="lenguaje"
                            id="lenguaje"
                          />
                          <label for="lenguaje">Lenguaje de Señas</label>
                        </div>
                        <div class="formGroup checkboxForm">
                          <input
                            type="checkbox"
                            name="primerosAux"
                            id="primerosAux"
                          />
                          <label for="primerosAux">Primeros Auxilios</label>
                        </div>
                        <div class="formGroup checkboxForm">
                          <input
                            type="checkbox"
                            name="otrasCapacidades"
                            id="otrasCapacidades"
                          />
                          <label for="otrasCapacidades">Otros:</label>
                          <textarea
                            name="otrasCapacidadesTexto"
                            id="otrasCapacidadesTexto"
                            cols="30"
                            rows="10"
                            maxlength="200"
                            style="
                              width: 250px;
                              font-size: 12px;
                              padding: 8px;
                              height: 60px;
                              border: 1px solid #333;
                              border-radius: 4px;
                              resize: none;
                            "
                          ></textarea>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="containerFooter">
                    <div class="buttonsTools">
                      <button type="button" class="modalFormCancel">
                        Cancelar
                      </button>
                      <button type="submit" id="modalFormSubmit">
                        <span>Agregar</span>
                      </button>
                      <button
                        type="button"
                        id="modalFormUpdateSubmit"
                        style="display: none"
                      >
                        <span>Actualizar</span>
                      </button>
                    </div>
                  </div>
                </form>
                <input
                  type="hidden"
                  name="uid"
                  value=""
                  id="userAltaIdentifier"
                />
              </div>
            </div>

            <div
              class="formContainer"
              data-tabcontainer="accounts"
              data-visibility="false"
              style="padding-top: 20px; width: 800px"
            >
              <div class="containerBody">
                <p style="font-size: 12px; font-weight: bold; margin-left: 4px">
                  Buscar vehículo por numero de placa:
                </p>
                <div class="placa-search">
                  <form id="userVehicleSearch">
                    <input
                      type="text"
                      placeholder="Introducir placa del vehículo"
                      name="placa"
                      id="placa"
                      class="search-placa"
                      style="flex-grow: 1; outline: none"
                    />
                    <button type="submit" class="placa-button-icon">
                      <svg
                        width="20px"
                        height="20px"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g
                          id="SVGRepo_tracerCarrier"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        ></g>
                        <g id="SVGRepo_iconCarrier">
                          <path
                            d="M15 15L21 21"
                            stroke="#323232"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          ></path>
                          <path
                            d="M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z"
                            stroke="#323232"
                            stroke-width="2"
                          ></path>
                        </g>
                      </svg>
                    </button>
                  </form>
                </div>
                <div
                  id="vehiculos-searched"
                  style="
                    width: 100%;
                    display: block;
                    min-height: 40px;
                    padding: 0.5rem;
                    border: 1px solid gray;
                    margin-top: 1rem;
                  "
                ></div>
                <div id="vehicles-container-list" data-reference="">
                  <table id="vehicles-list">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Marca y modelo</th>
                        <th>Placas</th>
                        <th>Habilitado</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
                <div class="containerFooter">
                  <div class="buttonsTools">
                    <button type="button" class="modalFormCancel">
                      Cancelar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="formContainer"
              data-tabcontainer="files"
              data-visibility="false"
              style="padding-top: 20px"
            >
              <div class="containerBody">
                <h2
                  style="
                    font-size: 20px;
                    display: block;
                    line-height: 1;
                    color: #d3660e;
                  "
                >
                  Archivos
                </h2>
                <div class="files-container">
                  <div class="file-box">
                    <div
                      style="
                        padding: 4px;
                        border: 1px solid lightslategray;
                        border-radius: 2px;
                      "
                    >
                      <img
                        src="../assets/img/nopic.png"
                        alt="licenciaConcesionario"
                        id="licenciaConcesionarioPreview"
                        class="imagePreview"
                        style="
                          display: block;
                          width: 120px;
                          height: 120px;
                          object-fit: cover;
                        "
                      />
                      <label for="licenciaConcesionario">
                        <input
                          type="file"
                          name="licenciaConcesionario"
                          id="licenciaConcesionario"
                          style="display: none"
                          class="documentationFiles"
                        />
                        <div class="imageEdit">
                          <svg
                            width="32px"
                            height="32px"
                            viewBox="-9.6 -9.6 43.20 43.20"
                            id="Layer_1"
                            data-name="Layer 1"
                            xmlns="http://www.w3.org/2000/svg"
                            fill="#ffffff"
                            stroke="#ffffff"
                            transform="matrix(1, 0, 0, 1, 0, 0)"
                          >
                            <g
                              id="SVGRepo_bgCarrier"
                              stroke-width="0"
                              transform="translate(0,0), scale(1)"
                            >
                              <rect
                                x="-9.6"
                                y="-9.6"
                                width="43.20"
                                height="43.20"
                                rx="21.6"
                                fill="#e2e7e9"
                                strokewidth="0"
                              ></rect>
                            </g>
                            <g
                              id="SVGRepo_tracerCarrier"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke="#CCCCCC"
                              stroke-width="0.384"
                            ></g>
                            <g id="SVGRepo_iconCarrier">
                              <defs>
                                <style>
                                  .cls-1 {
                                    fill: none;
                                    stroke: #000000;
                                    stroke-miterlimit: 10;
                                    stroke-width: 1.9200000000000004;
                                  }
                                </style>
                              </defs>
                              <polyline
                                class="cls-1"
                                points="20.59 12 20.59 22.5 1.5 22.5 1.5 3.41 12.96 3.41"
                              ></polyline>
                              <path
                                class="cls-1"
                                d="M12,15.82l-4.77.95L8.18,12l9.71-9.71A2.69,2.69,0,0,1,19.8,1.5h0a2.7,2.7,0,0,1,2.7,2.7h0a2.69,2.69,0,0,1-.79,1.91Z"
                              ></path>
                            </g>
                          </svg>
                        </div>
                      </label>
                    </div>
                    <p>Licencia de Conducir</p>
                  </div>

                  <div class="file-box">
                    <div
                      style="
                        padding: 4px;
                        border: 1px solid lightslategray;
                        border-radius: 2px;
                      "
                    >
                      <img
                        src="../assets/img/nopic.png"
                        alt="polizaSeguro"
                        id="polizaSeguroPreview"
                        class="imagePreview"
                        style="
                          display: block;
                          width: 120px;
                          height: 120px;
                          object-fit: cover;
                        "
                      />
                      <label for="polizaSeguro">
                        <input
                          type="file"
                          name="polizaSeguro"
                          id="polizaSeguro"
                          style="display: none"
                          class="documentationFiles"
                        />
                        <div class="imageEdit">
                          <svg
                            width="32px"
                            height="32px"
                            viewBox="-9.6 -9.6 43.20 43.20"
                            id="Layer_1"
                            data-name="Layer 1"
                            xmlns="http://www.w3.org/2000/svg"
                            fill="#ffffff"
                            stroke="#ffffff"
                            transform="matrix(1, 0, 0, 1, 0, 0)"
                          >
                            <g
                              id="SVGRepo_bgCarrier"
                              stroke-width="0"
                              transform="translate(0,0), scale(1)"
                            >
                              <rect
                                x="-9.6"
                                y="-9.6"
                                width="43.20"
                                height="43.20"
                                rx="21.6"
                                fill="#e2e7e9"
                                strokewidth="0"
                              ></rect>
                            </g>
                            <g
                              id="SVGRepo_tracerCarrier"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke="#CCCCCC"
                              stroke-width="0.384"
                            ></g>
                            <g id="SVGRepo_iconCarrier">
                              <defs>
                                <style>
                                  .cls-1 {
                                    fill: none;
                                    stroke: #000000;
                                    stroke-miterlimit: 10;
                                    stroke-width: 1.9200000000000004;
                                  }
                                </style>
                              </defs>
                              <polyline
                                class="cls-1"
                                points="20.59 12 20.59 22.5 1.5 22.5 1.5 3.41 12.96 3.41"
                              ></polyline>
                              <path
                                class="cls-1"
                                d="M12,15.82l-4.77.95L8.18,12l9.71-9.71A2.69,2.69,0,0,1,19.8,1.5h0a2.7,2.7,0,0,1,2.7,2.7h0a2.69,2.69,0,0,1-.79,1.91Z"
                              ></path>
                            </g>
                          </svg>
                        </div>
                      </label>
                    </div>
                    <p>Póliza de Seguro</p>
                  </div>

                  <div class="file-box">
                    <div
                      style="
                        padding: 4px;
                        border: 1px solid lightslategray;
                        border-radius: 2px;
                      "
                    >
                      <img
                        src="../assets/img/nopic.png"
                        alt="ine"
                        id="inePreview"
                        class="imagePreview"
                        style="
                          display: block;
                          width: 120px;
                          height: 120px;
                          object-fit: cover;
                        "
                      />
                      <label for="ine">
                        <input
                          type="file"
                          name="ine"
                          id="ine"
                          style="display: none"
                          class="documentationFiles"
                        />
                        <div class="imageEdit">
                          <svg
                            width="32px"
                            height="32px"
                            viewBox="-9.6 -9.6 43.20 43.20"
                            id="Layer_1"
                            data-name="Layer 1"
                            xmlns="http://www.w3.org/2000/svg"
                            fill="#ffffff"
                            stroke="#ffffff"
                            transform="matrix(1, 0, 0, 1, 0, 0)"
                          >
                            <g
                              id="SVGRepo_bgCarrier"
                              stroke-width="0"
                              transform="translate(0,0), scale(1)"
                            >
                              <rect
                                x="-9.6"
                                y="-9.6"
                                width="43.20"
                                height="43.20"
                                rx="21.6"
                                fill="#e2e7e9"
                                strokewidth="0"
                              ></rect>
                            </g>
                            <g
                              id="SVGRepo_tracerCarrier"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke="#CCCCCC"
                              stroke-width="0.384"
                            ></g>
                            <g id="SVGRepo_iconCarrier">
                              <defs>
                                <style>
                                  .cls-1 {
                                    fill: none;
                                    stroke: #000000;
                                    stroke-miterlimit: 10;
                                    stroke-width: 1.9200000000000004;
                                  }
                                </style>
                              </defs>
                              <polyline
                                class="cls-1"
                                points="20.59 12 20.59 22.5 1.5 22.5 1.5 3.41 12.96 3.41"
                              ></polyline>
                              <path
                                class="cls-1"
                                d="M12,15.82l-4.77.95L8.18,12l9.71-9.71A2.69,2.69,0,0,1,19.8,1.5h0a2.7,2.7,0,0,1,2.7,2.7h0a2.69,2.69,0,0,1-.79,1.91Z"
                              ></path>
                            </g>
                          </svg>
                        </div>
                      </label>
                    </div>
                    <p>INE</p>
                  </div>

                  <div class="file-box">
                    <div
                      style="
                        padding: 4px;
                        border: 1px solid lightslategray;
                        border-radius: 2px;
                      "
                    >
                      <img
                        src="../assets/img/nopic.png"
                        alt="claveUnica"
                        id="claveUnicaPreview"
                        class="imagePreview"
                        style="
                          display: block;
                          width: 120px;
                          height: 120px;
                          object-fit: cover;
                        "
                      />
                      <label for="claveUnica">
                        <input
                          type="file"
                          name="claveUnica"
                          id="claveUnica"
                          style="display: none"
                          class="documentationFiles"
                        />
                        <div class="imageEdit">
                          <svg
                            width="32px"
                            height="32px"
                            viewBox="-9.6 -9.6 43.20 43.20"
                            id="Layer_1"
                            data-name="Layer 1"
                            xmlns="http://www.w3.org/2000/svg"
                            fill="#ffffff"
                            stroke="#ffffff"
                            transform="matrix(1, 0, 0, 1, 0, 0)"
                          >
                            <g
                              id="SVGRepo_bgCarrier"
                              stroke-width="0"
                              transform="translate(0,0), scale(1)"
                            >
                              <rect
                                x="-9.6"
                                y="-9.6"
                                width="43.20"
                                height="43.20"
                                rx="21.6"
                                fill="#e2e7e9"
                                strokewidth="0"
                              ></rect>
                            </g>
                            <g
                              id="SVGRepo_tracerCarrier"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke="#CCCCCC"
                              stroke-width="0.384"
                            ></g>
                            <g id="SVGRepo_iconCarrier">
                              <defs>
                                <style>
                                  .cls-1 {
                                    fill: none;
                                    stroke: #000000;
                                    stroke-miterlimit: 10;
                                    stroke-width: 1.9200000000000004;
                                  }
                                </style>
                              </defs>
                              <polyline
                                class="cls-1"
                                points="20.59 12 20.59 22.5 1.5 22.5 1.5 3.41 12.96 3.41"
                              ></polyline>
                              <path
                                class="cls-1"
                                d="M12,15.82l-4.77.95L8.18,12l9.71-9.71A2.69,2.69,0,0,1,19.8,1.5h0a2.7,2.7,0,0,1,2.7,2.7h0a2.69,2.69,0,0,1-.79,1.91Z"
                              ></path>
                            </g>
                          </svg>
                        </div>
                      </label>
                    </div>
                    <p>CURP</p>
                  </div>

                  <div class="file-box">
                    <div
                      style="
                        padding: 4px;
                        border: 1px solid lightslategray;
                        border-radius: 2px;
                      "
                    >
                      <img
                        src="../assets/img/nopic.png"
                        alt="gafeteSCT"
                        id="gafeteSCTPreview"
                        class="imagePreview"
                        style="
                          display: block;
                          width: 120px;
                          height: 120px;
                          object-fit: cover;
                        "
                      />
                      <label for="gafeteSCT">
                        <input
                          type="file"
                          name="gafeteSCT"
                          id="gafeteSCT"
                          style="display: none"
                          class="documentationFiles"
                        />
                        <div class="imageEdit">
                          <svg
                            width="32px"
                            height="32px"
                            viewBox="-9.6 -9.6 43.20 43.20"
                            id="Layer_1"
                            data-name="Layer 1"
                            xmlns="http://www.w3.org/2000/svg"
                            fill="#ffffff"
                            stroke="#ffffff"
                            transform="matrix(1, 0, 0, 1, 0, 0)"
                          >
                            <g
                              id="SVGRepo_bgCarrier"
                              stroke-width="0"
                              transform="translate(0,0), scale(1)"
                            >
                              <rect
                                x="-9.6"
                                y="-9.6"
                                width="43.20"
                                height="43.20"
                                rx="21.6"
                                fill="#e2e7e9"
                                strokewidth="0"
                              ></rect>
                            </g>
                            <g
                              id="SVGRepo_tracerCarrier"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke="#CCCCCC"
                              stroke-width="0.384"
                            ></g>
                            <g id="SVGRepo_iconCarrier">
                              <defs>
                                <style>
                                  .cls-1 {
                                    fill: none;
                                    stroke: #000000;
                                    stroke-miterlimit: 10;
                                    stroke-width: 1.9200000000000004;
                                  }
                                </style>
                              </defs>
                              <polyline
                                class="cls-1"
                                points="20.59 12 20.59 22.5 1.5 22.5 1.5 3.41 12.96 3.41"
                              ></polyline>
                              <path
                                class="cls-1"
                                d="M12,15.82l-4.77.95L8.18,12l9.71-9.71A2.69,2.69,0,0,1,19.8,1.5h0a2.7,2.7,0,0,1,2.7,2.7h0a2.69,2.69,0,0,1-.79,1.91Z"
                              ></path>
                            </g>
                          </svg>
                        </div>
                      </label>
                    </div>
                    <p>Gafete de la SCT</p>
                  </div>

                  <div class="file-box">
                    <div
                      style="
                        padding: 4px;
                        border: 1px solid lightslategray;
                        border-radius: 2px;
                      "
                    >
                      <img
                        src="../assets/img/nopic.png"
                        alt="fotografiaConcesionario"
                        id="fotografiaConcesionarioPreview"
                        class="imagePreview"
                        style="
                          display: block;
                          width: 120px;
                          height: 120px;
                          object-fit: cover;
                        "
                      />
                      <label for="fotografiaConcesionario">
                        <input
                          type="file"
                          name="fotografiaConcesionario"
                          id="fotografiaConcesionario"
                          style="display: none"
                          class="documentationFiles"
                        />
                        <div class="imageEdit">
                          <svg
                            width="32px"
                            height="32px"
                            viewBox="-9.6 -9.6 43.20 43.20"
                            id="Layer_1"
                            data-name="Layer 1"
                            xmlns="http://www.w3.org/2000/svg"
                            fill="#ffffff"
                            stroke="#ffffff"
                            transform="matrix(1, 0, 0, 1, 0, 0)"
                          >
                            <g
                              id="SVGRepo_bgCarrier"
                              stroke-width="0"
                              transform="translate(0,0), scale(1)"
                            >
                              <rect
                                x="-9.6"
                                y="-9.6"
                                width="43.20"
                                height="43.20"
                                rx="21.6"
                                fill="#e2e7e9"
                                strokewidth="0"
                              ></rect>
                            </g>
                            <g
                              id="SVGRepo_tracerCarrier"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke="#CCCCCC"
                              stroke-width="0.384"
                            ></g>
                            <g id="SVGRepo_iconCarrier">
                              <defs>
                                <style>
                                  .cls-1 {
                                    fill: none;
                                    stroke: #000000;
                                    stroke-miterlimit: 10;
                                    stroke-width: 1.9200000000000004;
                                  }
                                </style>
                              </defs>
                              <polyline
                                class="cls-1"
                                points="20.59 12 20.59 22.5 1.5 22.5 1.5 3.41 12.96 3.41"
                              ></polyline>
                              <path
                                class="cls-1"
                                d="M12,15.82l-4.77.95L8.18,12l9.71-9.71A2.69,2.69,0,0,1,19.8,1.5h0a2.7,2.7,0,0,1,2.7,2.7h0a2.69,2.69,0,0,1-.79,1.91Z"
                              ></path>
                            </g>
                          </svg>
                        </div>
                      </label>
                    </div>
                    <p>Concesionario</p>
                  </div>

                  <div class="file-box">
                    <div
                      style="
                        padding: 4px;
                        border: 1px solid lightslategray;
                        border-radius: 2px;
                      "
                    >
                      <img
                        src="../assets/img/nopic.png"
                        alt="datosAdicionales"
                        id="datosAdicionalesPreview"
                        class="imagePreview"
                        style="
                          display: block;
                          width: 120px;
                          height: 120px;
                          object-fit: cover;
                        "
                      />
                      <label for="datosAdicionales">
                        <input
                          type="file"
                          name="datosAdicionales"
                          id="datosAdicionales"
                          style="display: none"
                          class="documentationFiles"
                        />
                        <div class="imageEdit">
                          <svg
                            width="32px"
                            height="32px"
                            viewBox="-9.6 -9.6 43.20 43.20"
                            id="Layer_1"
                            data-name="Layer 1"
                            xmlns="http://www.w3.org/2000/svg"
                            fill="#ffffff"
                            stroke="#ffffff"
                            transform="matrix(1, 0, 0, 1, 0, 0)"
                          >
                            <g
                              id="SVGRepo_bgCarrier"
                              stroke-width="0"
                              transform="translate(0,0), scale(1)"
                            >
                              <rect
                                x="-9.6"
                                y="-9.6"
                                width="43.20"
                                height="43.20"
                                rx="21.6"
                                fill="#e2e7e9"
                                strokewidth="0"
                              ></rect>
                            </g>
                            <g
                              id="SVGRepo_tracerCarrier"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke="#CCCCCC"
                              stroke-width="0.384"
                            ></g>
                            <g id="SVGRepo_iconCarrier">
                              <defs>
                                <style>
                                  .cls-1 {
                                    fill: none;
                                    stroke: #000000;
                                    stroke-miterlimit: 10;
                                    stroke-width: 1.9200000000000004;
                                  }
                                </style>
                              </defs>
                              <polyline
                                class="cls-1"
                                points="20.59 12 20.59 22.5 1.5 22.5 1.5 3.41 12.96 3.41"
                              ></polyline>
                              <path
                                class="cls-1"
                                d="M12,15.82l-4.77.95L8.18,12l9.71-9.71A2.69,2.69,0,0,1,19.8,1.5h0a2.7,2.7,0,0,1,2.7,2.7h0a2.69,2.69,0,0,1-.79,1.91Z"
                              ></path>
                            </g>
                          </svg>
                        </div>
                      </label>
                    </div>
                    <p>Datos Adicionales</p>
                  </div>
                </div>
                <div class="containerFooter">
                  <div class="buttonsTools">
                    <button type="button" class="modalFormCancel">
                      Cancelar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="formContainer"
              data-tabcontainer="drivers"
              data-visibility="false"
              style="padding-top: 20px; width: 800px"
            >
              <div class="containerBody">
                <p
                  style="
                    font-size: 12px;
                    font-weight: bold;
                    margin-left: 4px;
                    margin-bottom: 4px;
                  "
                >
                  Buscar conductor mediante su correo electrónico:
                </p>
                <div class="placa-search">
                  <form id="userEmailSearch">
                    <input
                      type="text"
                      placeholder="Introducir correo del conductor"
                      name="searchEmail"
                      id="searchEmail"
                      class="search-placa"
                      style="flex-grow: 1; outline: none"
                    />
                    <button type="submit" class="placa-button-icon">
                      <svg
                        width="20px"
                        height="20px"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g
                          id="SVGRepo_tracerCarrier"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        ></g>
                        <g id="SVGRepo_iconCarrier">
                          <path
                            d="M15 15L21 21"
                            stroke="#323232"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          ></path>
                          <path
                            d="M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z"
                            stroke="#323232"
                            stroke-width="2"
                          ></path>
                        </g>
                      </svg>
                    </button>
                  </form>
                </div>
                <div
                  id="usuarios-searched"
                  style="
                    width: 100%;
                    display: block;
                    min-height: 40px;
                    padding: 0.5rem;
                    border: 1px solid gray;
                    margin-top: 1rem;
                  "
                ></div>
                <div id="usuarios-container-list" data-reference="">
                  <table id="usuarios-list">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Nombre Completo</th>
                        <th>Teléfono</th>
                        <th>Correo</th>
                        <th>Gafete SCT</th>
                        <th>Habilitado</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
                <div class="containerFooter">
                  <div class="buttonsTools">
                    <button type="button" class="modalFormCancel">
                      Cancelar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Delete -->
        <div id="usuariosBajaModal" class="modalForm">
          <div class="formContainer">
            <div class="containerBody">
              <p>¿Estás seguro de dar de baja a este concesionario?</p>
              <form id="userBaja">
                <input id="userDeleteIdentifier" type="hidden" value="" />
                <input id="userDeleteEmailId" type="hidden" value="" />
                <div class="buttonsTools">
                  <button type="button" id="modalFormDeleteCancel">
                    <span>Cancelar</span>
                  </button>
                  <button type="submit" id="modalFormDeleteSubmit">
                    <span>Eliminar</span>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </main>

      <div class="modal-preview-image" data-visibility="hidden">
        <div class="modal-bg"></div>
        <div class="modal-container">
          <img
            src="../assets/img/nopic.png"
            alt="previewImage"
            id="full-width-preview-Image"
          />
        </div>
      </div>

      <div class="modal-preview-document" data-visibility="hidden">
        <div class="modal-bg"></div>
        <div class="modal-container">
          <iframe
            id="full-width-preview-Document"
            src="#"
            width="600"
            height="700"
            frameborder="0"
          ></iframe>
        </div>
      </div>

      <!-- Footer -->
      <footer>
        <p id="copyrightFooter"></p>
      </footer>
    </div>
  </body>
  <script>
    function inputValidOnlyNumbers() {
      this.value = this.value.replace(/[^0-9]/g, "");
    }

    function inputValidOnlyTextOrSpaces() {
      this.value = this.value.replace(/[^a-zA-Z\s]/g, "");
    }

    function inputValidOnlyTextOrNumber() {
      this.value = this.value.replace(/[^a-zA-Z0-9]/g, "");
    }

    function inputValidOnlyTextNumberAndSpaces() {
      this.value = this.value.replace(/[^a-zA-Z0-9\s]/g, "");
    }

    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll("input.only-letters").forEach((input) => {
        input.addEventListener("input", inputValidOnlyTextOrSpaces);
      });

      document.querySelectorAll("input.only-numbers").forEach((input) => {
        input.addEventListener("input", inputValidOnlyNumbers);
      });

      document.querySelectorAll("input.only-characters").forEach((input) => {
        input.addEventListener("input", inputValidOnlyTextOrNumber);
      });

      document
        .querySelectorAll("input.only-characters-spaces")
        .forEach((input) => {
          input.addEventListener("input", inputValidOnlyTextNumberAndSpaces);
        });
    });
  </script>
  <script src="https://www.gstatic.com/firebasejs/8.2.6/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.6/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.6/firebase-firestore.js"></script>
  <script type="module" src="../js/config/auth-config.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.6/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.6/firebase-storage.js"></script>
  <script src="../js/global-context.js"></script>
  <script
    type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"
  ></script>
  <script
    type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"
  ></script>
  <script
    type="text/javascript"
    src="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css"
  ></script>
  <script
    type="text/javascript"
    src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"
  ></script>
  <script type="module">
    import {
      getDocumentsFromCollection,
      createUserAndSaveData,
      deleteDocumentByUid,
      getDocumentByUid,
      updateDocumentByUid,
      getVehiclesFromInnerDocumentCollection,
      getConductoresromInnerDocumentCollection,
      resetPasswordToUser,
      firestore,
      storage,
    } from "../js/config/config.js";

    const monthStrings = [
      "Enero",
      "Febrero",
      "Marzo",
      "Abril",
      "Mayo",
      "Junio",
      "Julio",
      "Agosto",
      "Septiembre",
      "Octubre",
      "Noviembre",
      "Diciembre",
    ];

    let permissions = {};
    const CONCESIONARIOS_COLLECTION = "concesionarios";
    const VEHICULOS_COLLECTION = "vehiculos";
    // Main Table
    var usersTable = document.querySelector("#concesionariosTable");
    var usersDataTableContext = null;
    // Modal Dialogs
    const modalDialogAdd = document.querySelector("#usuariosAltaModal");
    const modalDialogEdit = document.querySelector("#usuariosEditModal");
    const modalDialogDelete = document.querySelector("#usuariosBajaModal");
    // Modal Form (Add)
    const modalForm = document.querySelector("form#userAlta");
    const deleteForm = document.querySelector("#userBaja");
    // Modal Buttons
    const userAddbutton = document.querySelector("button#userAdd");
    const userAddSubmitButton = document.querySelector("#modalFormSubmit");
    const userUpdateButton = document.querySelector("#modalFormUpdateSubmit");
    const deleteCancelButton = document.querySelector("#modalFormDeleteCancel");
    let addCancelButton = document.querySelectorAll("button.modalFormCancel");
    let GLOBAL_USER_DATA = null;

    const statusTrueIcon =
      '<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2C16.714 2 19.0711 2 20.5355 3.46447C22 4.92893 22 7.28595 22 12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22ZM16.0303 8.96967C16.3232 9.26256 16.3232 9.73744 16.0303 10.0303L11.0303 15.0303C10.7374 15.3232 10.2626 15.3232 9.96967 15.0303L7.96967 13.0303C7.67678 12.7374 7.67678 12.2626 7.96967 11.9697C8.26256 11.6768 8.73744 11.6768 9.03033 11.9697L10.5 13.4393L14.9697 8.96967C15.2626 8.67678 15.7374 8.67678 16.0303 8.96967Z" fill="#399220"></path> </g></svg>';
    const statusFalseIcon =
      '<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2C16.714 2 19.0711 2 20.5355 3.46447C22 4.92893 22 7.28595 22 12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22ZM8.96965 8.96967C9.26254 8.67678 9.73742 8.67678 10.0303 8.96967L12 10.9394L13.9696 8.96969C14.2625 8.6768 14.7374 8.6768 15.0303 8.96969C15.3232 9.26258 15.3232 9.73746 15.0303 10.0303L13.0606 12L15.0303 13.9697C15.3232 14.2625 15.3232 14.7374 15.0303 15.0303C14.7374 15.3232 14.2625 15.3232 13.9696 15.0303L12 13.0607L10.0303 15.0303C9.73744 15.3232 9.26256 15.3232 8.96967 15.0303C8.67678 14.7374 8.67678 14.2626 8.96967 13.9697L10.9393 12L8.96965 10.0303C8.67676 9.73744 8.67676 9.26256 8.96965 8.96967Z" fill="#c7c7c7"></path> </g></svg>';

    addCancelButton.forEach((element) => {
      element.addEventListener("click", async () => {
        handleViewAltaModal(false);
      });
    });

    userAddbutton.addEventListener("click", () => {
      if (permissions.create == "0") {
        negateAccess();
        return;
      }
      document.querySelector("#modalFormSubmit").style.display = "block";
      document.querySelector("#modalFormUpdateSubmit").style.display = "none";
      document.querySelector("#otrasCapacidadesTexto").value = "";
      document.querySelector("#otrasEnfermedadesTexto").value = "";
      document.querySelectorAll("button.tab-button").forEach((element) => {
        const attribute = element.getAttribute("data-tab");
        if (
          attribute === "files" ||
          attribute === "accounts" ||
          attribute === "drivers"
        ) {
          element.style.display = "none";
        }
      });
      handleViewAltaModal(true);
    });

    deleteCancelButton.addEventListener("click", async () => {
      handleViewDeleteModal(false);
    });

    userUpdateButton.addEventListener("click", async (e) => {
      await handleUpdateUserInformation(e);
    });

    function clearDataTable() {
      usersDataTableContext.clear().destroy();
    }

    async function handleRefetchingData() {
      clearDataTable();
      await fetchingData();
    }

    // Modal Add Form Submit Event
    modalForm.addEventListener("submit", async (e) => await handleSubmit(e));
    deleteForm.addEventListener(
      "submit",
      async (e) => await handleDeleteSubmit(e)
    );

    function handleViewAltaModal(e) {
      if (e === true) {
        modalDialogAdd.classList.add("modalViewTrue");
        return;
      }
      GLOBAL_USER_DATA = null;
      document.querySelector("table#vehicles-list tbody").innerHTML = "";
      document.querySelector("div#vehiculos-searched").innerHTML = "";
      document.querySelector("input#placa").value = "";
      document
        .querySelector("#usuariosAltaModal")
        .setAttribute("data-reference", "");
      Object.entries(modalForm).forEach((item) => {
        const element = item[1];
        const type = element.type;
        if (type === "text" || type === "email" || type === "tel") {
          element.value = "";
          return;
        }
        if (type === "select-one" || type === "select") {
          element.value = "M";
          return;
        }
        if (type === "checkbox") {
          element.checked = false;
          return;
        }
        document.querySelectorAll("button.tab-button").forEach((element) => {
          if (element.getAttribute("data-tab") === "data") {
            element.setAttribute("aria-selected", "true");
            return;
          }
          element.setAttribute("aria-selected", "false");
        });
        document.querySelectorAll("div.formContainer").forEach((element) => {
          if (element.getAttribute("data-tabcontainer") === "data") {
            element.setAttribute("data-visibility", "true");
            return;
          }
          element.setAttribute("data-visibility", "false");
        });
        document.querySelectorAll("img.imagePreview").forEach((element) => {
          element.src = "../assets/img/nopic.png";
        });
        return;
      });

      modalDialogAdd.classList.remove("modalViewTrue");
    }

    function handleViewEditModal(e) {
      if (e === true) {
        modalDialogEdit.classList.add("modalViewTrue");
        return;
      }
      modalDialogEdit.classList.remove("modalViewTrue");
    }

    function handleViewDeleteModal(e) {
      if (e === true) {
        modalDialogDelete.classList.add("modalViewTrue");
        return;
      }
      modalDialogDelete.classList.remove("modalViewTrue");
    }

    async function fetchingData() {
      const querySnapshots = await getDocumentsFromCollection(
        CONCESIONARIOS_COLLECTION
      );
      querySnapshots.forEach((doc) => {
        const document = doc.data();
        getDataFromDriversList(document);
      });

      usersDataTableContext = new DataTable(usersTable, {
        dom: "Bfrtip",
        buttons: [
          {
            extend: "collection",
            text: "Exportar",
            buttons: ["excelHtml5", "pdfHtml5", "print"],
          },
        ],
        oLanguage: {
          sSearch: "Busqueda:",
          oPaginate: {
            sFirst: "Primera",
            sPrevious: "Anterior",
            sNext: "Siguiente",
            sLast: "Ultima",
          },
        },
        language: {
          info: "Se muestran los registros _START_ al _END_ de _TOTAL_. ",
          infoEmpty: "No se muestran registros.",
          emptyTable: "No se registran datos en la tabla.",
          infoFiltered: "(Filtrado de _MAX_ registros).",
        },
      });
    }

    function getDataFromDriversList(list) {
      const cell_list = {
        uid: list.uid,
        cells: [
          list.nombre + " " + list.apellidoPaterno ||
            "" + " " + list.apellidoMaterno ||
            "",
          list.sexo,
          list.correoElectronico,
          list.telefono,
          list.curp || "",
          list.numeroEconomico,
          list.numGafeteSCT || "",
          formatDate(list.fechaAlta),
        ],
      };
      createRowToTable(cell_list);
    }

    const formatDate = (datetime) => {
      const [date, time] = datetime.slice(0, -5).split("T");
      const [year, month, day] = date.split("-");
      return day + " de " + monthStrings[parseInt(month) - 1] + " del " + year;
    };

    const validateEmail = (email) => {
      const pattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
      return pattern.test(email);
    };

    async function handleSubmit(e) {
      e.preventDefault();
      const targets = Object.entries(e.target).slice(0, -3);
      const emailInput = targets.find((item) => item[1].type === "email");
      if (!validateEmail(emailInput[1].value)) {
        window.alert("Favor de verificar correo, debe ser un correo válido.");
        return;
      }

      const preValidation = targets
        .filter(([key, item]) => item.getAttribute("data-length"))
        .map(([key, item]) => item);

      let hasAnError = false;

      preValidation.forEach((element) => {
        const inputString = element.value.length;
        const inputText = element.placeholder;
        const inputRequest = parseInt(element.getAttribute("data-length"));
        if (!(inputString >= inputRequest)) {
          hasAnError = true;
          element.style.border = "1px solid red";
        } else {
          element.style.border = "1px solid gray";
        }
      });

      if (hasAnError) {
        window.alert("Favor de llenar los campos correctamente.");
        return;
      }

      const values = targets.map((input, index) => {
        const name = input[1].name;
        let val =
          input[1].type === "checkbox" ? input[1].checked : input[1].value;
        return { [name]: val };
      });

      const isCreated = await createUserAndSaveData(
        values,
        CONCESIONARIOS_COLLECTION
      );
      if (isCreated === false) return;
      await handleRefetchingData();
      handleViewAltaModal(false);
    }

    async function handleUpdateUserInformation(e) {
      const targets = Object.entries(modalForm).slice(0, -3);
      const emailInput = targets.find((item) => item[1].type === "email");
      if (!validateEmail(emailInput[1].value)) {
        window.alert("Favor de verificar correo, debe ser un correo válido.");
        return;
      }

      const preValidation = targets
        .filter(([key, item]) => item.getAttribute("data-length"))
        .map(([key, item]) => item);

      let hasAnError = false;

      preValidation.forEach((element) => {
        const inputString = element.value.length;
        const inputText = element.placeholder;
        const inputRequest = parseInt(element.getAttribute("data-length"));
        if (!(inputString >= inputRequest)) {
          hasAnError = true;
          element.style.border = "1px solid red";
        } else {
          element.style.border = "1px solid gray";
        }
      });

      if (hasAnError) {
        window.alert("Favor de llenar los campos correctamente.");
        return;
      }

      const values = targets.map((input, index) => {
        const name = input[1].name;
        let val =
          input[1].type === "checkbox" ? input[1].checked : input[1].value;
        return { [name]: val };
      });

      const userUID = document
        .querySelector("#usuariosAltaModal")
        .getAttribute("data-reference");

      const isUpdated = await updateDocumentByUid(
        values,
        userUID,
        CONCESIONARIOS_COLLECTION
      );
      if (isUpdated === false) return;
      await handleRefetchingData();
      handleViewAltaModal(false);
    }

    async function handleDeleteSubmit(e) {
      e.preventDefault();

      const uid = document.querySelector("#userDeleteIdentifier").value;
      const email = document.querySelector("#userDeleteEmailId").value;
      const hasBeenDeleted = await deleteDocumentByUid(
        uid,
        CONCESIONARIOS_COLLECTION
      );

      if (hasBeenDeleted === false) return;
      await handleRefetchingData();
      handleViewDeleteModal(false);
    }

    function createRowToTable(list) {
      const tableRow = document.createElement("tr");
      list.cells.forEach((item) => {
        const tableCell = document.createElement("td");
        const cellNode = document.createTextNode(item);
        tableCell.appendChild(cellNode);
        tableRow.appendChild(tableCell);
      });

      const tools = createActionButtons(list.uid);
      tableRow.appendChild(tools);
      document
        .querySelector("table#concesionariosTable tbody")
        .insertAdjacentElement("beforeend", tableRow);
    }

    function createActionButtons(u) {
      const tableCell = document.createElement("td");
      const resetPasswordButton = document.createElement("button");
      const updateButton = document.createElement("button");
      const deleteButton = document.createElement("button");

      const updateAttrs = {
        type: "button",
        class: "cellButtonTool",
        "data-type": "update",
        "data-id": u,
        title: "Editar",
      };
      const resetPasswordAttrs = {
        type: "button",
        class: "cellButtonTool",
        "data-type": "update",
        "data-id": u,
        title: "Reestablecer contraseña",
      };
      const deleteAttrs = {
        type: "button",
        class: "cellButtonTool",
        "data-type": "delete",
        "data-id": u,
        title: "Eliminar",
      };

      elementSetAttributes(updateButton, updateAttrs);
      elementSetAttributes(resetPasswordButton, resetPasswordAttrs);
      elementSetAttributes(deleteButton, deleteAttrs);
      elementSetAttributes(tableCell, { "data-type": "tools" });

      updateButton.innerHTML = `<svg width="16px" height="16px" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill="#c88528" d="M2.85 10.907l-.672 1.407L.033 17.26a.535.535 0 0 0 0 .368.917.917 0 0 0 .155.184.917.917 0 0 0 .184.155A.54.54 0 0 0 .56 18a.48.48 0 0 0 .18-.033l4.946-2.145 1.407-.672 8.53-8.53-4.244-4.243zM4.857 14l-1.515.657L4 13.143l.508-1.064 1.415 1.413zM16.707 5.537l-4.244-4.244.707-.707a2 2 0 0 1 2.83 0L17.414 2a2 2 0 0 1 0 2.83z"></path> </g></svg>`;
      resetPasswordButton.innerHTML = `<svg width="16px" height="16px" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M17.408 3.412a1.974 1.974 0 0 0 0-2.82 1.973 1.973 0 0 0-2.819 0l-.29.29-.59-.59a1.009 1.009 0 0 0-1.65.35l-.35-.35a1.004 1.004 0 1 0-1.42 1.42l.35.35a1.033 1.033 0 0 0-.58.58l-.35-.35a1.004 1.004 0 0 0-1.42 1.42L9.879 5.3l-3.02 3.01c-.01.01-.02.03-.03.04A4.885 4.885 0 0 0 5 8a5 5 0 1 0 5 5 4.885 4.885 0 0 0-.35-1.83c.01-.01.03-.02.04-.03l7.718-7.728zM5 15a2 2 0 1 1 0-4 2 2 0 0 1 0 4z" fill="#287bc8" fill-rule="evenodd"></path> </g></svg>`;
      deleteButton.innerHTML = `<svg width="16px" height="16px" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill="#c84028" d="M13 18H5a2 2 0 0 1-2-2V7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v9a2 2 0 0 1-2 2zm3-15a1 1 0 0 1-1 1H3a1 1 0 0 1 0-2h3V1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1h3a1 1 0 0 1 1 1z"></path> </g></svg>`;

      updateButton.addEventListener("click", (e) => handleUpdateUser(e));
      resetPasswordButton.addEventListener("click", (e) =>
        handleResetPassword(e.currentTarget.parentNode)
      );
      deleteButton.addEventListener("click", (e) =>
        handleDeleteUser(e, e.currentTarget.parentNode)
      );

      tableCell.insertAdjacentElement("beforeend", updateButton);
      tableCell.insertAdjacentElement("beforeend", resetPasswordButton);
      tableCell.insertAdjacentElement("beforeend", deleteButton);

      return tableCell;
    }

    const handleResetPassword = async (e) => {
      if (permissions.reset == "0") {
        negateAccess();
        return;
      }
      const confirmMessage =
        "Se le enviará al usuario un correo de reestablecimiento de contraseña, ¿Estas seguro de proceder con la acción?";
      if (confirm(confirmMessage)) {
        const tableRow = e.parentNode;
        const email = tableRow.childNodes[2].innerText;
        const hasBeenReseted = await resetPasswordToUser(email);
      }
    };

    function elementSetAttributes(el, attrs) {
      for (var key in attrs) {
        el.setAttribute(key, attrs[key]);
      }
    }

    async function handleUpdateUser(e) {
      if (permissions.update == "0") {
        negateAccess();
        return;
      }
      const uid = e.currentTarget.getAttribute("data-id");
      document
        .querySelector("#usuariosAltaModal")
        .setAttribute("data-reference", uid);
      document.querySelector("#userAltaIdentifier").value = uid;
      document.querySelector("#modalFormSubmit").style.display = "none";
      document.querySelector("#modalFormUpdateSubmit").style.display = "block";
      document.querySelectorAll("button.tab-button").forEach((element) => {
        element.style.display = "block";
      });
      handleViewAltaModal(true);
      await getOperatorByUid(uid);
    }

    function handleDeleteUser(e, node) {
      if (permissions.delete == "0") {
        negateAccess();
        return;
      }
      const uid = e.currentTarget.getAttribute("data-id");

      const tableRow = node.parentNode;
      const email = tableRow.childNodes[2].innerText;
      const input = document.querySelector("#userDeleteIdentifier");
      const emailInput = document.querySelector("#userDeleteEmailId");
      input.value = uid;
      emailInput.value = email;
      handleViewDeleteModal(true);
    }

    async function getOperatorByUid(uid) {
      let data = await getDocumentByUid(uid, CONCESIONARIOS_COLLECTION);
      GLOBAL_USER_DATA = data;
      let formEntries = Object.values(modalForm).filter(
        (item) => item.type !== "button" && item.type !== "submit"
      );

      formEntries.forEach((element) => {
        const { name, type } = element;
        if (type === "checkbox") {
          element.checked = data[name];
          return;
        }
        element.value = data[name] || "";
        return;
      });
    }

    const modalTabButtons = document.querySelectorAll("button.tab-button");

    modalTabButtons.forEach((tab, index) => {
      tab.addEventListener("click", ({ currentTarget }) => {
        const nameTab = currentTarget.getAttribute("data-tab");
        const isSelected = currentTarget.getAttribute("aria-selected");
        if (isSelected == "true") {
          return false;
        }
        modalTabButtons.forEach((element) => {
          if (
            element.getAttribute("aria-selected") == "true" ||
            element.getAttribute("data-tab") !== nameTab
          ) {
            element.setAttribute("aria-selected", "false");
            return;
          }
          element.setAttribute("aria-selected", "true");
        });
        const tabContents = document.querySelectorAll("div.formContainer");
        tabContents.forEach((element) => {
          element.setAttribute("data-visibility", "false");
          if (element.getAttribute("data-tabcontainer") == nameTab) {
            element.setAttribute("data-visibility", "true");
          }
        });
      });
    });

    document
      .querySelector(`button.tab-button[data-tab="files"]`)
      .addEventListener("click", async function (e) {
        const uid = document
          .querySelector("#usuariosAltaModal")
          .getAttribute("data-reference");
        const storageReference = storage
          .ref()
          .child(`${CONCESIONARIOS_COLLECTION}/${uid}`);
        const result = await storageReference.listAll();
        if (result.items.length > 0) {
          const urls = await Promise.all(
            result.items.map(async (item) => {
              try {
                return await item.getDownloadURL();
              } catch (error) {
                console.error("Error obteniendo url: ", error);
                return null;
              }
            })
          );

          const files = urls.map((item) => {
            return {
              url: item,
              name: item
                .split("%2F")[2]
                .split("?")[0]
                .split(".")[0]
                .split("__")[1],
              type: item.split("%2F")[2].split("?")[0].split(".")[1],
            };
          });

          document.querySelectorAll("img.imagePreview").forEach((element) => {
            const { name, alt } = element;
            const currentFile = files.filter((item) => item.name === alt);
            element.src =
              currentFile[0].type !== "pdf"
                ? currentFile[0].url
                : "https://www.svgrepo.com/show/255818/pdf.svg";

            element.addEventListener("click", function (e) {
              const modal = document.querySelector("div.modal-preview-image");
              const modalDoc = document.querySelector(
                "div.modal-preview-document"
              );
              if (currentFile[0].type !== "pdf") {
                modal.setAttribute("data-visibility", "visible");
                document.getElementById("full-width-preview-Image").src =
                  currentFile[0].url;
                return;
              }

              modalDoc.setAttribute("data-visibility", "visible");
              document.getElementById("full-width-preview-Document").src =
                currentFile[0].url;
            });
          });
        }
      });

    document.querySelectorAll("div.modal-bg").forEach((element, array) =>
      element.addEventListener("click", function (e) {
        const modal = e.target.parentNode;
        modal.setAttribute("data-visibility", "hidden");
      })
    );

    async function statusFunction(element, array) {
      const { uid, habilitado } = element;
      if (array?.filter((item) => item.habilitado === true).length > 2) {
        alert("Concesionario no puede tener mas de 2 vehiculos habilitados");
        return;
      }

      const userUID = document
        .querySelector("#usuariosAltaModal")
        .getAttribute("data-reference");
      const message = habilitado
        ? "Estas seguro de deshabilitar el vehiculo al usuario?"
        : "Estas seguro de habilitar el vehiculo al usuario";
      if (confirm(message)) {
        const documentUpdated = await firestore
          .collection(CONCESIONARIOS_COLLECTION)
          .doc(userUID)
          .collection("vehiculos")
          .doc(uid)
          .update({
            habilitado: !habilitado,
          })
          .then(() => true)
          .catch(() => false);

        if (documentUpdated) {
          alert("Se ha actualizado de manera correcta.");
          await getAndRenderVehiclesFromUser();
          return;
        }
        alert("No se pudo actualizar, favor de verificar.");
      }
    }

    async function statusFunctionConductores(element, array) {
      const { uid, habilitado } = element;
      if (array?.filter((item) => item.habilitado === true).length > 2) {
        alert("Concesionario no puede tener mas de 2 vehiculos habilitados");
        return;
      }

      const userUID = document
        .querySelector("#usuariosAltaModal")
        .getAttribute("data-reference");
      const message = habilitado
        ? "Estas seguro de deshabilitar el vehiculo al usuario?"
        : "Estas seguro de habilitar el vehiculo al usuario";
      if (confirm(message)) {
        const documentUpdated = await firestore
          .collection(CONCESIONARIOS_COLLECTION)
          .doc(userUID)
          .collection("conductores")
          .doc(uid)
          .update({
            habilitado: !habilitado,
          })
          .then(() => true)
          .catch(() => false);

        if (documentUpdated) {
          alert("Se ha actualizado de manera correcta.");
          await getAndRenderDriversFromUser();
          return;
        }
        alert("No se pudo actualizar, favor de verificar.");
      }
    }

    function createVehicleRow(element, index, array) {
      const { marca, modelo, placa, habilitado, uid } = element;
      const tableRow = document.createElement("tr");
      const rowCellIndex = document.createElement("td");
      const rowCellBrandModel = document.createElement("td");
      const rowCellPlaca = document.createElement("td");
      const rowCellStatus = document.createElement("td");

      rowCellIndex.insertAdjacentText("afterbegin", index + 1);
      rowCellBrandModel.insertAdjacentText("afterbegin", marca + " " + modelo);
      rowCellPlaca.insertAdjacentText("afterbegin", placa);

      const checkboxStatus = document.createElement("button");
      checkboxStatus.setAttribute("type", "button");
      checkboxStatus.setAttribute("data-status", habilitado);
      checkboxStatus.insertAdjacentHTML(
        "afterbegin",
        habilitado ? statusTrueIcon : statusFalseIcon
      );
      checkboxStatus.addEventListener("click", async function (e) {
        await statusFunction(element, array);
      });
      checkboxStatus.setAttribute("class", "statusButtonVehicle");
      rowCellStatus.insertAdjacentElement("beforeend", checkboxStatus);

      tableRow.insertAdjacentElement("beforeend", rowCellIndex);
      tableRow.insertAdjacentElement("beforeend", rowCellBrandModel);
      tableRow.insertAdjacentElement("beforeend", rowCellPlaca);
      tableRow.insertAdjacentElement("beforeend", rowCellStatus);

      return tableRow;
    }

    function createConductorRow(element, index, array) {
      const {
        nombre,
        apellidoMaterno,
        apellidoPaterno,
        telefono,
        numGafeteSCT,
        correoElectronico,
        habilitado,
        uid,
      } = element;
      const tableRow = document.createElement("tr");
      const rowCellIndex = document.createElement("td");
      const rowCellNombreCompleto = document.createElement("td");
      const rowCellTelefono = document.createElement("td");
      const rowCellGafete = document.createElement("td");
      const rowCellCorreo = document.createElement("td");
      const rowCellStatus = document.createElement("td");

      rowCellIndex.insertAdjacentText("afterbegin", index + 1);
      rowCellNombreCompleto.insertAdjacentText(
        "afterbegin",
        nombre + " " + apellidoPaterno + " " + apellidoMaterno
      );
      rowCellTelefono.insertAdjacentText("afterbegin", telefono);
      rowCellCorreo.insertAdjacentText("afterbegin", correoElectronico);
      rowCellGafete.insertAdjacentText("afterbegin", numGafeteSCT);

      const checkboxStatus = document.createElement("button");
      checkboxStatus.setAttribute("type", "button");
      checkboxStatus.setAttribute("data-status", habilitado);
      checkboxStatus.insertAdjacentHTML(
        "afterbegin",
        habilitado ? statusTrueIcon : statusFalseIcon
      );
      checkboxStatus.addEventListener("click", async function (e) {
        await statusFunctionConductores(element, array);
      });
      checkboxStatus.setAttribute("class", "statusButtonVehicle");
      rowCellStatus.insertAdjacentElement("beforeend", checkboxStatus);

      tableRow.insertAdjacentElement("beforeend", rowCellIndex);
      tableRow.insertAdjacentElement("beforeend", rowCellNombreCompleto);
      tableRow.insertAdjacentElement("beforeend", rowCellTelefono);
      tableRow.insertAdjacentElement("beforeend", rowCellCorreo);
      tableRow.insertAdjacentElement("beforeend", rowCellGafete);
      tableRow.insertAdjacentElement("beforeend", rowCellStatus);

      return tableRow;
    }

    async function getAndRenderVehiclesFromUser() {
      document.querySelector("#placa").value = "";
      const uid = document
        .querySelector("#usuariosAltaModal")
        .getAttribute("data-reference");

      const vehiclesFromUser = await getVehiclesFromInnerDocumentCollection(
        uid,
        CONCESIONARIOS_COLLECTION
      );
      if (vehiclesFromUser.length === 0) return;
      document.querySelector("table#vehicles-list tbody").innerHTML = "";
      document.querySelector("#vehiculos-searched").innerHTML = "";
      const table = document.createElement("table");
      const tableBody = document.createElement("tbody");

      vehiclesFromUser.forEach((element, index, array) => {
        const tableRow = createVehicleRow(element, index, array);
        document
          .querySelector("table#vehicles-list tbody")
          .insertAdjacentElement("beforeend", tableRow);
      });
    }

    async function getAndRenderDriversFromUser() {
      document.querySelector("#searchEmail").value = "";
      const uid = document
        .querySelector("#usuariosAltaModal")
        .getAttribute("data-reference");
      const conductoresFromUser =
        await getConductoresromInnerDocumentCollection(
          uid,
          CONCESIONARIOS_COLLECTION
        );

      if (conductoresFromUser.length === 0) return;
      document.querySelector("table#usuarios-list tbody").innerHTML = "";
      document.querySelector("#usuarios-searched").innerHTML = "";
      const table = document.createElement("table");
      const tableBody = document.createElement("tbody");

      conductoresFromUser.forEach((element, index, array) => {
        const tableRow = createConductorRow(element, index, array);
        document
          .querySelector("table#usuarios-list tbody")
          .insertAdjacentElement("beforeend", tableRow);
      });
    }

    $(`button.tab-button[data-tab="accounts"]`).on("click", async function (e) {
      await getAndRenderVehiclesFromUser();
    });

    $(`button.tab-button[data-tab="drivers"]`).on("click", async function (e) {
      await getAndRenderDriversFromUser();
    });

    window.addEventListener("DOMContentLoaded", async () => {
      await fetchingData();
      await rolesPermission();
    });

    document
      .querySelectorAll("input.documentationFiles")
      .forEach((element, index) => {
        element.addEventListener("change", async function (e) {
          try {
            const file = e.target.files[0];
            const reader = new FileReader();
            const { name, type } = e.target;
            const responseUpload = await uploadImages(
              file,
              name,
              file.name.split(".")[1]
            );
            if (responseUpload) {
              reader.onload = function (event) {
                const url = event.target.result;
                const dom = name + "Preview";
                const imageDom = document.getElementById(dom);
                imageDom.src =
                  file.name.split(".")[1] === "pdf"
                    ? "https://www.svgrepo.com/show/255818/pdf.svg"
                    : url;
              };
              reader.readAsDataURL(file);
            }
          } catch (error) {
            console.error(error.message);
          }
        });
      });

    const uploadImages = async (file, name, type) => {
      try {
        const uid = document
          .getElementById("usuariosAltaModal")
          .getAttribute("data-reference");

        if (file === null || file === undefined) return;

        const reference = storage
          .ref()
          .child(
            `${CONCESIONARIOS_COLLECTION}/${uid}/` + ("__" + name + "." + type)
          );
        await reference.put(file);

        const url = await reference.getDownloadURL();

        if (url) {
          return true;
        } else {
          throw new Error();
        }
      } catch (error) {
        console.error("Error al subir imagenes, ", error);
        return false;
      }
    };

    /* Buscar y asignar Vehiculo*/
    document
      .querySelector("#userVehicleSearch")
      .addEventListener("submit", async function (e) {
        e.preventDefault();
        try {
          const searchString = e.target[0].value;
          const response = await firestore
            .collection(VEHICULOS_COLLECTION)
            .where("placa", "==", searchString.toUpperCase())
            .get()
            .then((snapshot) => {
              const res = [];
              snapshot.forEach((doc) => {
                res.push({ id: doc.id, data: doc.data() });
              });
              return res;
            })
            .catch((err) => {
              console.error(err);
            });
          if (response) {
            const box = document.querySelector("#vehiculos-searched");

            response.map((item, index, array) => {
              const { id } = item;
              const { marca, modelo, placa, propietario, owners } = item.data;

              const list = document.createElement("div");
              list.setAttribute("class", "optionVehicle");
              const span = document.createElement("span");
              span.innerText = `${marca} ${modelo} - ${placa}`;
              list.insertAdjacentElement("beforeend", span);

              const button = document.createElement("button");
              button.setAttribute("type", "button");
              button.setAttribute("class", "botonAsignar");
              button.addEventListener("click", async function (e) {
                if (permissions.assign == "0") {
                  negateAccess();
                  return;
                }
                const uid = document
                  .querySelector("#usuariosAltaModal")
                  .getAttribute("data-reference");
                const message =
                  "Estas seguro de asignar este vehiculo al concesionario?";
                if (confirm(message)) {
                  const hasBeenAssigned = await firestore
                    .collection(CONCESIONARIOS_COLLECTION)
                    .doc(uid)
                    .collection("vehiculos")
                    .doc(id)
                    .set({ ...item.data, habilitado: false })
                    .then((snapshot) => {
                      alert("Se ha asignado el vehiculo al usuario.");
                      return true;
                    })
                    .catch((error) => {
                      const errorMessage =
                        "Se ha presentado un error, favor de verificar con un administrador.";
                      alert(errorMessage);
                      console.error(error);
                      return false;
                    });
                  if (hasBeenAssigned === true) {
                    await getAndRenderVehiclesFromUser();
                  }
                }
              });

              button.innerText = "Asignar";

              list.insertAdjacentElement("beforeend", button);
              box.insertAdjacentElement("beforeend", list);
            });
          }
        } catch (error) {
          console.error("Se ha presentado un error, ", error);
        }
      });

    /* Buscar y asignar Conductor*/ 
    document
      .querySelector("#userEmailSearch")
      .addEventListener("submit", async function (e) {
        e.preventDefault();
        try {
          const searchString = e.target[0].value;
          const response = await firestore
            .collection("conductores")
            .where("correoElectronico", "==", searchString)
            .get()
            .then((snapshot) => {
              const res = [];
              snapshot.forEach((doc) => {
                res.push({ id: doc.id, data: doc.data() });
              });
              return res;
            })
            .catch((err) => {
              console.error(err);
            });
          if (response) {
            const box = document.querySelector("#usuarios-searched");

            response.map((item, index, array) => {
              const { id } = item;
              const {
                nombre,
                apellidoPaterno,
                apellidoMaterno,
                telefono,
                numGafeteSCT,
              } = item.data;

              const list = document.createElement("div");
              list.setAttribute("class", "optionVehicle");
              const span = document.createElement("span");
              span.innerText = `${nombre} ${apellidoPaterno} ${apellidoMaterno} - ${telefono} - Gafete: ${numGafeteSCT}`;
              list.insertAdjacentElement("beforeend", span);

              const button = document.createElement("button");
              button.setAttribute("type", "button");
              button.setAttribute("class", "botonAsignar");
              button.addEventListener("click", async function (e) {
                if (permissions.assign == "0") {
                  negateAccess();
                  return;
                }
                const uid = document
                  .querySelector("#usuariosAltaModal")
                  .getAttribute("data-reference");
                const message =
                  "Estas seguro de asignar este conductor al concesionario?";
                if (confirm(message)) {
                  const hasBeenAssigned = await firestore
                    .collection(CONCESIONARIOS_COLLECTION)
                    .doc(uid)
                    .collection("conductores")
                    .doc(id)
                    .set({ ...item.data, habilitado: false })
                    .then((snapshot) => {
                      alert("Se ha asignado el conductor al concesionario.");
                      return true;
                    })
                    .catch((error) => {
                      alert(
                        "Se ha presentado un error, favor de verificar con un administrador."
                      );
                      console.error(error);
                      return false;
                    });
                  if (hasBeenAssigned === true) {
                    await getAndRenderDriversFromUser();
                  }
                }
              });

              button.innerText = "Asignar";

              list.insertAdjacentElement("beforeend", button);
              box.insertAdjacentElement("beforeend", list);
            });
          }
        } catch (error) {
          console.error("Se ha presentado un error, ", error);
        }
      });

    const rolesPermission = async () => {
      const permission = sessionStorage.getItem("concesionariosPermission");
      if (permission === null || permission === undefined) {
        window.location.replace("../index.html");
      }
      permission.split("$").forEach((permit) => {
        const name = permit.split(",")[0];
        const value = permit.split(",")[1];
        permissions[name] = value;
      });
    };

    const negateAccess = () => {
      window.alert(
        "No cuentas con los permisos necesarios para realizar esta operación."
      );
    };
  </script>
</html>
